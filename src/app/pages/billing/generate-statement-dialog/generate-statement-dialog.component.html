<h2 mat-dialog-title>
  <mat-icon>description</mat-icon>
  Prospetto spese mensile
</h2>

<div mat-dialog-content>
  <form [formGroup]="form" class="form-grid">
    <div class="row top-row">
      <mat-form-field appearance="outline">
        <mat-label>Appartamento</mat-label>
        <mat-select formControlName="apartmentId" required>
          <mat-option *ngFor="let a of apartments" [value]="a.id">{{ a.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Mese</mat-label>
        <mat-select formControlName="month">
          <mat-option *ngFor="let m of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="m">{{m}}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Anno</mat-label>
        <input matInput type="number" formControlName="year">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Affitto</mat-label>
        <input matInput type="number" formControlName="rent">
      </mat-form-field>
    </div>

    <mat-divider></mat-divider>

    <div class="rows-table" *ngIf="!loading">
      <div class="row header">
        <div>Voce</div><div>Prec.</div><div>Attuale</div><div>Consumo</div><div>Costo/unità</div><div>Importo</div>
      </div>
      <div class="row" *ngFor="let r of rows">
        <div class="label">{{ r.label }}</div>
        <div>{{ r.previous ?? '-' }}</div>
        <div>{{ r.current ?? '-' }}</div>
        <div>{{ r.consumption }} {{ r.unit }}</div>
        <div>
          <mat-form-field appearance="outline" class="unit-field">
            <input matInput type="number" [(ngModel)]="r.unitCost" [ngModelOptions]="{standalone: true}">
          </mat-form-field>
          €/{{ r.unit }}
        </div>
        <div>{{ (r.consumption * r.unitCost) | number:'1.2-2' }} €</div>
      </div>
      
      <!-- Riga lavanderia solo per Appartamento 8 -->
      <div class="row laundry-row" *ngIf="isApartment8()">
        <div class="label">
          <mat-icon class="laundry-icon">local_laundry_service</mat-icon>
          {{ laundryRow.label }}
        </div>
        <div>{{ laundryRow.previous ?? '-' }}</div>
        <div>{{ laundryRow.current ?? '-' }}</div>
        <div>{{ laundryRow.consumption }} {{ laundryRow.unit }}</div>
        <div>
          <mat-form-field appearance="outline" class="unit-field">
            <input matInput type="number" [(ngModel)]="laundryRow.unitCost" [ngModelOptions]="{standalone: true}">
          </mat-form-field>
          €/{{ laundryRow.unit }}
        </div>
        <div>{{ (laundryRow.consumption * laundryRow.unitCost) | number:'1.2-2' }} €</div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>TARI (N. Urbana)</mat-label>
        <input matInput type="number" formControlName="tari">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Costo contatori</mat-label>
        <input matInput type="number" formControlName="meterFee">
      </mat-form-field>

      <mat-checkbox formControlName="saveDefaults">Salva come default per tutti</mat-checkbox>
    </div>

    <div class="error" *ngIf="error">{{ error }}</div>
  </form>
</div>

<div mat-dialog-actions align="end">
  <button mat-stroked-button mat-dialog-close>Annulla</button>
  <button mat-flat-button color="primary" (click)="download()" [disabled]="loading || form.invalid">
    <mat-icon>download</mat-icon>
    Scarica PDF
  </button>
</div>


