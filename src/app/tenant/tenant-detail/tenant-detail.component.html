<div class="container">
  <!-- Loading spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Messaggio di errore -->
  <div *ngIf="errorMessage" class="error-message">
    <mat-icon>error</mat-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <ng-container *ngIf="tenant && !isLoading">
    <div class="action-buttons">
      <button mat-raised-button color="primary" routerLink="/tenant/list">
        <mat-icon>arrow_back</mat-icon>
        Torna alla lista
      </button>
      <div class="right-buttons">
        <button mat-raised-button color="primary" [routerLink]="['/tenant/edit', tenant.id]">
          <mat-icon>edit</mat-icon>
          Modifica
        </button>
        <button mat-raised-button color="warn" (click)="deleteTenant()">
          <mat-icon>delete</mat-icon>
          Elimina
        </button>
      </div>
    </div>

    <mat-card class="tenant-card">
      <mat-card-header>
        <div class="tenant-header">
          <div class="avatar-container">
            <div class="tenant-avatar">
              <mat-icon>person</mat-icon>
            </div>
          </div>
          <div class="tenant-title">
            <h1>{{ tenant.firstName }} {{ tenant.lastName }}</h1>
            <div class="tenant-subtitle">
              <mat-icon>email</mat-icon>
              <span>{{ tenant.email }}</span>
            </div>
            <div class="tenant-subtitle">
              <mat-icon>phone</mat-icon>
              <span>{{ tenant.phone }}</span>
            </div>
          </div>
        </div>
      </mat-card-header>

      <mat-card-content>
        <mat-tab-group animationDuration="300ms">
          <mat-tab label="Informazioni Generali">
            <div class="tab-content">
              <h2>Dettagli Inquilino</h2>
              
              <mat-list>
                <mat-list-item>
                  <h3 matListItemTitle>Indirizzo</h3>
                  <span matListItemLine>{{ tenant.address || 'Non specificato' }}</span>
                </mat-list-item>
                
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <h3 matListItemTitle>Tipo Documento</h3>
                  <span matListItemLine>{{ tenant.documentType }}</span>
                </mat-list-item>
                
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <h3 matListItemTitle>Numero Documento</h3>
                  <span matListItemLine>{{ tenant.documentNumber }}</span>
                </mat-list-item>
                
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <h3 matListItemTitle>Data Scadenza Documento</h3>
                  <span matListItemLine>{{ formatDate(tenant.documentExpiryDate) }}</span>
                </mat-list-item>
                
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <h3 matListItemTitle>Preferenze Comunicazioni</h3>
                  <span matListItemLine>
                    <mat-chip-set>
                      <mat-chip *ngIf="tenant.communicationPreferences.email" class="chip-blue" selected>Email</mat-chip>
                      <mat-chip *ngIf="tenant.communicationPreferences.sms" class="chip-yellow" selected>SMS</mat-chip>
                      <mat-chip *ngIf="tenant.communicationPreferences.whatsapp" class="chip-green" selected>Whats App</mat-chip>
                    </mat-chip-set>
                  </span>
                </mat-list-item>
                
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <h3 matListItemTitle>Note</h3>
                  <span matListItemLine>{{ tenant.notes || 'Nessuna nota' }}</span>
                </mat-list-item>
              </mat-list>

              <h2 class="mt-4">Documenti d'identità</h2>
    
              <div class="documents-container">
                <!-- Immagine fronte documento -->
                <div *ngIf="tenant.documentFrontImage" class="document-card">
                  <div class="document-header">
                    <h3>Fronte Documento</h3>
                    <button mat-icon-button color="primary" (click)="downloadDocument('front', 'fronte-documento')">
                      <mat-icon>file_download</mat-icon>
                    </button>
                  </div>
                  <div class="document-image-container">
                    <img [src]="getImageUrl(tenant.documentFrontImage)" alt="Fronte documento" class="document-image">
                  </div>
                </div>
                
                <!-- Messaggio se nessuna immagine fronte -->
                <div *ngIf="!tenant.documentFrontImage" class="no-document-card">
                  <mat-icon>image_not_supported</mat-icon>
                  <p>Nessuna immagine fronte caricata</p>
                </div>
                
                <!-- Immagine retro documento -->
                <div *ngIf="tenant.documentBackImage" class="document-card">
                  <div class="document-header">
                    <h3>Retro Documento</h3>
                    <button mat-icon-button color="primary" (click)="downloadDocument('back', 'retro-documento')">
                      <mat-icon>file_download</mat-icon>
                    </button>
                  </div>
                  <div class="document-image-container">
                    <img [src]="getImageUrl(tenant.documentBackImage)" alt="Retro documento" class="document-image">
                  </div>
                </div>
                
                <!-- Messaggio se nessuna immagine retro -->
                <div *ngIf="!tenant.documentBackImage" class="no-document-card">
                  <mat-icon>image_not_supported</mat-icon>
                  <p>Nessuna immagine retro caricata</p>
                </div>
              </div>
            </div>
          </mat-tab>
          
          <mat-tab label="Contratti">
            <div class="tab-content">
              <h2>Contratti Attivi</h2>
              
              <div *ngIf="activeLeases.length === 0 && !errorMessage" class="no-data-message">
                <mat-icon>info</mat-icon>
                <span>Nessun contratto attivo per questo inquilino</span>
              </div>
              
              <div *ngIf="errorMessage" class="error-message">
                <mat-icon>error</mat-icon>
                <span>{{ errorMessage }}</span>
              </div>
              
              <mat-card *ngFor="let lease of activeLeases" class="lease-card">
                <mat-card-header>
                  <mat-card-title>Contratto #{{ lease.id }}</mat-card-title>
                  <mat-card-subtitle>Appartamento ID: {{ lease.apartmentId }}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="lease-info">
                    <div class="lease-detail">
                      <strong>Inizio:</strong> {{ formatDate(lease.startDate) }}
                    </div>
                    <div class="lease-detail">
                      <strong>Fine:</strong> {{ formatDate(lease.endDate) }}
                    </div>
                    <div class="lease-detail">
                      <strong>Canone Mensile:</strong> €{{ lease.monthlyRent }}
                    </div>
                  </div>
                </mat-card-content>
                <mat-card-actions>
                  <button mat-button [routerLink]="['/lease/detail', lease.id]" color="primary">
                    <mat-icon>visibility</mat-icon> Visualizza Dettagli
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>